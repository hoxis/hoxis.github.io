<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="B7lUGKNplO6JqOkIcuTGZN1PEfj8inK2ZVhJw5Z3HQ0">
<meta name="baidu-site-verification" content="qzPNJMTINu">
<meta name="baidu-site-verification" content="pg0OpMkHdJ">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">




  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Verdana:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon2.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon1.ico?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="ansible,学习,教程">





  <link rel="alternate" href="/atom.xml" title="hoxis' blog" type="application/atom+xml">






<meta name="description" content="本文主要记录本人学习ansible中的一些知识点，对ansible的一些模块进行一些简单的介绍。">
<meta name="keywords" content="ansible,学习,教程">
<meta property="og:type" content="article">
<meta property="og:title" content="【Ansible学习】- Ansible初探">
<meta property="og:url" content="https://hoxis.github.io/about ansible.html">
<meta property="og:site_name" content="hoxis&#39; blog">
<meta property="og:description" content="本文主要记录本人学习ansible中的一些知识点，对ansible的一些模块进行一些简单的介绍。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515564257351.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515564367657.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1514178939675.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1514179663946.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1514179908403.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515151749113.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515215799249.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515215694583.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515216105015.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515216783015.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515218215574.jpg">
<meta property="og:image" content="https://www.github.com/hoxis/token4md/raw/master/1515219697082.jpg">
<meta property="og:updated_time" content="2019-04-08T13:46:26.466Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【Ansible学习】- Ansible初探">
<meta name="twitter:description" content="本文主要记录本人学习ansible中的一些知识点，对ansible的一些模块进行一些简单的介绍。">
<meta name="twitter:image" content="https://www.github.com/hoxis/token4md/raw/master/1515564257351.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":10,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hoxis.github.io/about ansible.html">





<!-- 添加DaoVioce -->

  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "7f3d6e70"
    });
  daovoice('update');
  </script>


  <title>【Ansible学习】- Ansible初探 | hoxis' blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f502d954566dcd3865de243d3125357d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  
  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/hoxis" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hoxis' blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">生命在于折腾</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-top">
          <a href="/top/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-signal"></i> <br>
            
            阅读排行
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-resources">
          <a href="/resources/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-cloud-download"></i> <br>
            
            资源
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hoxis.github.io/about ansible.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hoxis">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hoxis' blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">【Ansible学习】- Ansible初探</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-05T13:47:32+08:00">
                2018-01-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/about ansible.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/about ansible.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/about ansible.html" class="leancloud_visitors" data-flag-title="【Ansible学习】- Ansible初探">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,489
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          
              <div class="post-description">
                  本文主要记录本人学习ansible中的一些知识点，对ansible的一些模块进行一些简单的介绍。
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <p>本文主要记录本人学习ansible中的一些知识点，对ansible的一些模块进行一些简单的介绍。</p>
<a id="more"></a>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install ansible</span><br></pre></td></tr></table></figure>
<h1 id="Ansible基础"><a href="#Ansible基础" class="headerlink" title="Ansible基础"></a>Ansible基础</h1><h2 id="Ansible架构图"><a href="#Ansible架构图" class="headerlink" title="Ansible架构图"></a>Ansible架构图</h2><p><img src="https://www.github.com/hoxis/token4md/raw/master/1515564257351.jpg" alt="Ansible架构图"></p>
<p>Ansible核心组件说明</p>
<ul>
<li>Ansible：Ansible的核心程序</li>
<li>Host Lnventory：记录了每一个由Ansible管理的主机信息，信息包括ssh端口，root帐号密码，ip地址等等。可以通过file来加载，可以通过CMDB加载</li>
<li>Playbooks：YAML格式文件，多个任务定义在一个文件中，使用时可以统一调用，<code>剧本</code>用来定义那些主机需要调用那些模块来完成的功能</li>
<li>Core Modules：Ansible执行任何管理任务都不是由Ansible自己完成，而是由核心模块完成；Ansible管理主机之前，先调用<code>core Modules</code>中的模块，然后指明管理Host Lnventory中的主机，就可以完成管理主机。</li>
<li>Custom Modules：自定义模块，完成Ansible核心模块无法完成的功能，此模块支持任何语言编写。</li>
<li>Connection Plugins：连接插件，Ansible和Host通信使用</li>
</ul>
<h2 id="Ansible执行过程"><a href="#Ansible执行过程" class="headerlink" title="Ansible执行过程"></a>Ansible执行过程</h2><p>暖色调的代表已经模块化<br><img src="https://www.github.com/hoxis/token4md/raw/master/1515564367657.jpg" alt="Ansible执行过程"></p>
<h2 id="清单文件"><a href="#清单文件" class="headerlink" title="清单文件"></a>清单文件</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[servers]</span></span><br><span class="line">172<span class="selector-class">.20</span><span class="selector-class">.21</span><span class="selector-class">.120</span></span><br><span class="line">172<span class="selector-class">.20</span><span class="selector-class">.21</span><span class="selector-class">.121</span></span><br><span class="line">172<span class="selector-class">.20</span><span class="selector-class">.21</span><span class="selector-class">.123</span></span><br></pre></td></tr></table></figure>
<p>默认清单文件是<code>/etc/ansible/hosts</code>。</p>
<p>同时也可以在运行时通过<code>-i</code>参数来指定清单文件。</p>
<h2 id="测试主机连通性"><a href="#测试主机连通性" class="headerlink" title="测试主机连通性"></a>测试主机连通性</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible www.baidu.com -m ping</span><br></pre></td></tr></table></figure>
<p>发现执行结果异常，这是因为<code>ansible</code>只纳管定义在<strong>清单文件</strong>中的主机。</p>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1514178939675.jpg" alt="需要清单文件"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible servers -m ping</span><br><span class="line">ansible servers -m ping -o</span><br></pre></td></tr></table></figure>
<p>通过<code>-o</code>参数，可以让结果在一行中进行显示。</p>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1514179663946.jpg" alt="测试主机连通性"></p>
<h2 id="执行远程指令"><a href="#执行远程指令" class="headerlink" title="执行远程指令"></a>执行远程指令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible servers -m shell -a <span class="string">'uptime'</span></span><br><span class="line">ansible servers -m <span class="built_in">command</span> -a <span class="string">'uptime'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1514179908403.jpg" alt="执行远程指令"></p>
<h2 id="远程主机的yum管理"><a href="#远程主机的yum管理" class="headerlink" title="远程主机的yum管理"></a>远程主机的yum管理</h2><h3 id="确认软件是否安装"><a href="#确认软件是否安装" class="headerlink" title="确认软件是否安装"></a>确认软件是否安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ansible servers -m shell -a 'rpm -qa|grep httpd'</span></span><br><span class="line"> [WARNING]: Consider using yum, dnf or zypper module rather than running rpm</span><br><span class="line"></span><br><span class="line">172.20.21.121 | FAILED | rc=1 &gt;&gt;</span><br><span class="line">non-zero <span class="built_in">return</span> code</span><br></pre></td></tr></table></figure>
<h3 id="安装httpd"><a href="#安装httpd" class="headerlink" title="安装httpd"></a>安装httpd</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ansible servers -m yum -a 'name=httpd state=latest'</span></span><br><span class="line">172.20.21.121 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Repository base is listed more than once in the configuration\nRepository updates is listed more than once in the configuration\nRepository extras is listed more than once in the configuration\nRepository centosplus is listed more than once in the configuration\nThere are unfinished transactions remaining. You might consider running yum-complete-transaction, or \"yum-complete-transaction --cleanup-only\" and \"yum history redo last\", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).\nThe program yum-complete-transaction is found in the yum-utils package.\n"</span>, </span><br><span class="line">    <span class="string">"rc"</span>: 0, </span><br><span class="line">    <span class="string">"results"</span>: [</span><br><span class="line">        ...<span class="string">"</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="再次安装"><a href="#再次安装" class="headerlink" title="再次安装"></a>再次安装</h3><p>再次安装时，就会检查客户端已安装的组件是否是最新的，若是最新的就不会再次安装。<code>changed</code>字段会返回<code>false</code>。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ansible servers -m yum -a 'name=httpd state=latest'</span></span><br><span class="line">172.20.21.121 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">""</span>, </span><br><span class="line">    <span class="string">"rc"</span>: 0, </span><br><span class="line">    <span class="string">"results"</span>: [</span><br><span class="line">        <span class="string">"All packages providing httpd are up to date"</span>, </span><br><span class="line">        <span class="string">""</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Ansible组件-Inventory"><a href="#Ansible组件-Inventory" class="headerlink" title="Ansible组件 - Inventory"></a>Ansible组件 - Inventory</h1><h2 id="Inventory主机清单"><a href="#Inventory主机清单" class="headerlink" title="Inventory主机清单"></a>Inventory主机清单</h2><p><a href="http://docs.ansible.com/ansible/intro_inventory.html" target="_blank" rel="noopener">inventory文件</a>通常用于定义要管理主机的认证信息，例如ssh登录所需的用户名、密码以及key相关信息。<br><code>/etc/ansible/hosts</code>文件配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[apache]</span><br><span class="line">172.20.21.121</span><br><span class="line">172.20.21.123</span><br><span class="line"></span><br><span class="line">[nginx]</span><br><span class="line">172.20.21.[120:121]</span><br><span class="line"></span><br><span class="line"># 把一个组作为另一个组的子成员</span><br><span class="line">[servers:children]</span><br><span class="line">apache</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"># 定义组变量</span><br><span class="line">[servers:vars]</span><br><span class="line">ansible_ssh_user='root'</span><br><span class="line">ansible_ssh_pass='123456'</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ansible apache --list-hosts</span></span><br><span class="line">  hosts (2):</span><br><span class="line">    172.20.21.121</span><br><span class="line">    172.20.21.123</span><br><span class="line">[root@centos7 ~]<span class="comment"># ansible nginx --list-hosts</span></span><br><span class="line">  hosts (2):</span><br><span class="line">    172.20.21.120</span><br><span class="line">    172.20.21.121</span><br><span class="line">[root@centos7 ~]<span class="comment"># ansible servers --list-hosts</span></span><br><span class="line">  hosts (3):</span><br><span class="line">    172.20.21.121</span><br><span class="line">    172.20.21.123</span><br><span class="line">    172.20.21.120</span><br><span class="line">[root@centos7 ~]<span class="comment"># ansible all -m shell -a 'hostname' -o</span></span><br><span class="line">172.20.21.123 | SUCCESS | rc=0 | (stdout) centos7</span><br><span class="line">172.20.21.121 | SUCCESS | rc=0 | (stdout) centos7</span><br><span class="line">172.20.21.120 | SUCCESS | rc=0 | (stdout) centos7</span><br></pre></td></tr></table></figure>
<h2 id="Ansible-Inventory-内置参数"><a href="#Ansible-Inventory-内置参数" class="headerlink" title="Ansible Inventory 内置参数"></a>Ansible Inventory 内置参数</h2><table>
<thead>
<tr>
<th>参数</th>
<th>用途</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>ansible_ssh_host</td>
<td>将要连接的远程主机名ssh地址</td>
<td>ansible_ssh_host=192.168.1.100</td>
</tr>
<tr>
<td>ansible_ssh_port</td>
<td>ssh端口</td>
<td>ansible_ssh_port=3000</td>
</tr>
<tr>
<td>ansible_ssh_user</td>
<td>ssh 用户名</td>
<td>ansible_ssh_user=user</td>
</tr>
<tr>
<td>ansible_ssh_pass</td>
<td>ssh 密码</td>
<td>ansible_ssh_pass=pass</td>
</tr>
<tr>
<td>ansible_sudo</td>
<td>sudo 用户</td>
<td></td>
</tr>
<tr>
<td>ansible_sudo_pass</td>
<td>sudo 密码</td>
<td></td>
</tr>
<tr>
<td>ansible_sudo_exe</td>
<td>sudo 执行路径</td>
<td>ansible_sudo_exe=/usr/bin/sudo</td>
</tr>
<tr>
<td>ansible_connection</td>
<td>hosts 连接方式</td>
<td>ansible_connection=local</td>
</tr>
<tr>
<td>ansible_ssh_private_key_file</td>
<td>hosts 私钥</td>
<td>ansible_ssh_private_key_file=/root/key</td>
</tr>
</tbody>
</table>
<h1 id="Ansible组件-Ad-Hoc"><a href="#Ansible组件-Ad-Hoc" class="headerlink" title="Ansible组件 - Ad-Hoc"></a>Ansible组件 - Ad-Hoc</h1><p>ad hoc，临时的，在ansible中是指需要快速执行，并且不需要报错的命令。对于复杂的命令则需要playbook。</p>
<h2 id="执行命令-m-shell"><a href="#执行命令-m-shell" class="headerlink" title="执行命令 -m shell"></a>执行命令 -m shell</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ansible servers -m shell -a 'hostname' -o</span></span><br><span class="line">172.20.21.121 | SUCCESS | rc=0 | (stdout) centos7</span><br><span class="line">172.20.21.123 | SUCCESS | rc=0 | (stdout) centos7</span><br><span class="line">172.20.21.120 | SUCCESS | rc=0 | (stdout) centos7</span><br><span class="line">[root@centos7 ~]<span class="comment"># ansible servers -m shell -a 'uname -r' -o</span></span><br><span class="line">172.20.21.121 | SUCCESS | rc=0 | (stdout) 3.10.0-514.26.2.el7.x86_64</span><br><span class="line">172.20.21.123 | SUCCESS | rc=0 | (stdout) 3.10.0-514.26.2.el7.x86_64</span><br><span class="line">172.20.21.120 | SUCCESS | rc=0 | (stdout) 3.10.0-514.26.2.el7.x86_64</span><br></pre></td></tr></table></figure>
<h2 id="复制文件-m-copy"><a href="#复制文件-m-copy" class="headerlink" title="复制文件 -m copy"></a>复制文件 -m copy</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m copy -a <span class="string">"src=test.sh dest=/tmp"</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515151749113.jpg" alt="复制文件"></p>
<h2 id="软件包管理-m-yum"><a href="#软件包管理-m-yum" class="headerlink" title="软件包管理 -m yum"></a>软件包管理 -m yum</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible apache -m yum -a <span class="string">"name=vim state=present"</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515215799249.jpg" alt="软件包安装"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible apache -m yum -a <span class="string">'name=httpd state=absent'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515215694583.jpg" alt="软件包卸载"></p>
<h2 id="服务管理-m-service"><a href="#服务管理-m-service" class="headerlink" title="服务管理 -m service"></a>服务管理 -m service</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible apache -m service -a <span class="string">"name=httpd state=restarted enabled=yes"</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515216105015.jpg" alt="服务管理"></p>
<h1 id="Ansible组件-Facts"><a href="#Ansible组件-Facts" class="headerlink" title="Ansible组件 - Facts"></a>Ansible组件 - Facts</h1><p>facts组件是Ansible用于采集被管理主机信息的功能，可以使用<code>setup</code>模块查看主机所有的facts信息。可以使用<code>filter</code>参数对结果进行过滤。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible apache -m setup</span><br><span class="line">ansible apache -m setup -a <span class="string">"filter=ansible_default_ipv4"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515216783015.jpg" alt="setup模块"></p>
<h1 id="Ansible组件-playbook"><a href="#Ansible组件-playbook" class="headerlink" title="Ansible组件 - playbook"></a>Ansible组件 - playbook</h1><p><code>playbook</code>是有一个或者多个<code>play</code>组成的列表。<code>play</code>的主要功能在于将实现归并为一组的主机装扮成实现通过ansible中的<code>task</code>定义好的角色<code>role</code>。</p>
<p>根本上来讲，所谓的<code>task</code>无非是调用ansible的一个<code>module</code>。将多个<code>play</code>组织在一个<code>playbook</code>中，即可以让他们联合起来按事先编排的机制完成某一任务。</p>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515218215574.jpg" alt="playbook结构"></p>
<h2 id="playbook示例"><a href="#playbook示例" class="headerlink" title="playbook示例"></a>playbook示例</h2><h3 id="yaml剧本"><a href="#yaml剧本" class="headerlink" title="yaml剧本"></a>yaml剧本</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- hosts: apache</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Install httpd</span><br><span class="line">    yum: <span class="attribute">name</span>=httpd <span class="attribute">state</span>=present</span><br><span class="line"></span><br><span class="line">  - name: copy httpd conf</span><br><span class="line">    template: <span class="attribute">src</span>=/etc/httpd/conf/httpd.conf <span class="attribute">dest</span>=/etc/httpd/conf/httpd.conf</span><br><span class="line">              <span class="attribute">owner</span>=root <span class="attribute">group</span>=root <span class="attribute">mode</span>=0644</span><br><span class="line">    notify:</span><br><span class="line">    - Restart Apache Service</span><br><span class="line"></span><br><span class="line">  - name: <span class="builtin-name">enable</span> httpd is runing</span><br><span class="line">    service: <span class="attribute">name</span>=httpd <span class="attribute">state</span>=started <span class="attribute">enabled</span>=<span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">  - name: Restart Apache Service</span><br><span class="line">    service: <span class="attribute">name</span>=httpd <span class="attribute">state</span>=restarted</span><br></pre></td></tr></table></figure>
<h3 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook apapche.yaml --syntax-check</span><br><span class="line">ansible-playbook apapche.yaml --list-task</span><br><span class="line">ansible-playbook apapche.yaml --list-hosts</span><br></pre></td></tr></table></figure>
<h3 id="执行playbook"><a href="#执行playbook" class="headerlink" title="执行playbook"></a>执行playbook</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook apapche.yaml</span><br></pre></td></tr></table></figure>
<p><img src="https://www.github.com/hoxis/token4md/raw/master/1515219697082.jpg" alt="执行playbook"></p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.png" alt="hoxis wechat" style="width: auto; height:200px; max-width: 100%;">
    <div>提供 CSDN 资料免费下载服务，欢迎来撩~</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>赞赏一杯咖啡</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="hoxis 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.jpg" alt="hoxis 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <!--
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    hoxis
  </li>
  -->
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    hoxis  |  微信公众号【不正经程序员】
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://hoxis.github.io/about ansible.html" title="【Ansible学习】- Ansible初探">https://hoxis.github.io/about ansible.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
  <li class="post-copyright-license">
    并保留本声明和上方二维码。感谢您的阅读和支持！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ansible/" rel="tag"><i class="fa fa-tag"></i> ansible</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Codewars-Find-the-unique-number.html" rel="next" title="【Codewars每日一题】- Find the unique number">
                <i class="fa fa-chevron-left"></i> 【Codewars每日一题】- Find the unique number
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Codewars-Rectangle-into-Squares.html" rel="prev" title="【Codewars每日一题】- Rectangle into Squares">
                【Codewars每日一题】- Rectangle into Squares <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="hoxis">
            
              <p class="site-author-name" itemprop="name">hoxis</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">195</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">97</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a rel="external nofollow" href="https://github.com/hoxis" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a rel="external nofollow" href="https://www.zhihu.com/people/mobi/posts" target="_blank" title="知乎">
                    
                      <i class="fa fa-fw fa-globe"></i>知乎</a>
                </span>
              
            
          </div>

          
          

          
          
          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/books-xiao-gou-qian-qian.html" title="钱钱是条狗？--读《小狗钱钱》" target="_blank">钱钱是条狗？--读《小狗钱钱》</a>
                  </li>
                
                  <li>
                    <a href="/good-things-ocr.html" title="这些好用的文字识别软件，你一定用得上！| 好物" target="_blank">这些好用的文字识别软件，你一定用得上！| 好物</a>
                  </li>
                
                  <li>
                    <a href="/jd-eclipse-offline.html" title="jd-eclipse离线包地址" target="_blank">jd-eclipse离线包地址</a>
                  </li>
                
                  <li>
                    <a href="/resource-heima-go.html" title="黑马/传智播客go语言视频教程" target="_blank">黑马/传智播客go语言视频教程</a>
                  </li>
                
                  <li>
                    <a href="/mysql-zhuanlan-17-how-to-get-rand-words.html" title="MySQL实战 | 17 如何随机显示数据？" target="_blank">MySQL实战 | 17 如何随机显示数据？</a>
                  </li>
                
              </ul>
            </div>
        

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible基础"><span class="nav-text">Ansible基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ansible架构图"><span class="nav-text">Ansible架构图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ansible执行过程"><span class="nav-text">Ansible执行过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清单文件"><span class="nav-text">清单文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试主机连通性"><span class="nav-text">测试主机连通性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行远程指令"><span class="nav-text">执行远程指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#远程主机的yum管理"><span class="nav-text">远程主机的yum管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#确认软件是否安装"><span class="nav-text">确认软件是否安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装httpd"><span class="nav-text">安装httpd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#再次安装"><span class="nav-text">再次安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible组件-Inventory"><span class="nav-text">Ansible组件 - Inventory</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Inventory主机清单"><span class="nav-text">Inventory主机清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ansible-Inventory-内置参数"><span class="nav-text">Ansible Inventory 内置参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible组件-Ad-Hoc"><span class="nav-text">Ansible组件 - Ad-Hoc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#执行命令-m-shell"><span class="nav-text">执行命令 -m shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#复制文件-m-copy"><span class="nav-text">复制文件 -m copy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#软件包管理-m-yum"><span class="nav-text">软件包管理 -m yum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#服务管理-m-service"><span class="nav-text">服务管理 -m service</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible组件-Facts"><span class="nav-text">Ansible组件 - Facts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible组件-playbook"><span class="nav-text">Ansible组件 - playbook</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#playbook示例"><span class="nav-text">playbook示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#yaml剧本"><span class="nav-text">yaml剧本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查"><span class="nav-text">检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行playbook"><span class="nav-text">执行playbook</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hoxis</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站已有
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      位访客  <i class="fa fa-user"></i>
    </span>
  

  
    <span class="site-pv">
      
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      人阅读  <i class="fa fa-eye"></i>
    </span>
  
</div>





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=65591650";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  
  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'Fo8lyzaHoPOI1RWT37jTn36p-gzGzoHsz',
        appKey: 'kLufSGh3R0S56mMQgG9495oK',
        placeholder: '来都来了，不撩一句嘛~，留言记得在上面留下【邮箱】，方便收到回复通知~',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>





  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("Fo8lyzaHoPOI1RWT37jTn36p-gzGzoHsz", "kLufSGh3R0S56mMQgG9495oK");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
